FROM jupyter/scipy-notebook:265297f221de

USER root

USER $NB_UID

RUN pip install --upgrade pip
RUN npm i npm@latest -g

# Install google-drive extension
RUN jupyter labextension install @jupyterlab/google-drive@^0.13.0

# Install nbgitpuller extension
RUN pip install nbgitpuller && \
    jupyter serverextension enable --py nbgitpuller --sys-prefix && \
    npm cache clean --force

# Clean up and fix permissions    
RUN rm -rf $CONDA_DIR/share/jupyter/lab/staging && \
    rm -rf /home/$NB_USER/.cache/yarn && \
    rm -rf /home/$NB_USER/.node-gyp && \
    fix-permissions $CONDA_DIR && \
    fix-permissions /home/$NB_USER

